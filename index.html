<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mobile FPS Community Pulse</title>
  <link rel="icon" href="assets/favicon.ico"/>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily:{sans:['Inter','ui-sans-serif','system-ui']},
          boxShadow:{soft:'0 10px 25px -10px rgba(0,0,0,.25)'}
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:Inter,system-ui,Arial,sans-serif}
    .pill{font-size:.78rem;padding:.35rem .6rem;border-radius:999px;background:#f4f4f5;border:1px solid #e4e4e7}
    .card{border-radius:1rem;background:#fff;border:1px solid rgba(24,24,27,.12);box-shadow:0 10px 25px -10px rgba(0,0,0,.25);padding:1.1rem}
    .hero{border-radius:1.25rem;padding:1.25rem;color:#fff;box-shadow:0 10px 25px -10px rgba(0,0,0,.25)}
    .brandbar{height:.4rem;border-radius:999px}
    .gauge-wrap{width:140px;height:140px;min-width:140px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,.08);border-radius:1rem}
    .gauge-wrap canvas{width:120px!important;height:120px!important}
    @media (max-width:640px){.gauge-wrap{width:110px;height:110px}.gauge-wrap canvas{width:100px!important;height:100px!important}}
    .chatbox{position:fixed;right:1rem;bottom:1rem;z-index:60}
  </style>
</head>
<body class="min-h-screen bg-gradient-to-b from-zinc-50 to-zinc-100 text-zinc-900">
  <header class="sticky top-0 z-40 backdrop-blur bg-white/70 border-b border-zinc-200">
    <div class="max-w-7xl mx-auto px-4 py-4 flex items-center gap-3">
      <h1 class="text-2xl font-semibold">Mobile FPS Community Pulse</h1>
      <nav class="ml-6 flex gap-2 text-sm">
        <button class="pill" data-tab="CODM">CODM</button>
        <button class="pill" data-tab="PUBG">PUBG Mobile</button>
        <button class="pill" data-tab="FREEFIRE">Free Fire</button>
        <button class="pill" data-tab="DELTA">Delta Force</button>
        <button class="pill" data-tab="COMPARE">Compare</button>
      </nav>
      <span class="pill ml-auto" id="last-updated">–</span>
      <button id="refreshBtn" class="pill">Refresh</button>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
    <div id="panels"></div>

    <section id="panel-COMPARE" class="game-panel hidden card">
      <div class="flex items-center justify-between mb-3">
        <div><h2 class="text-xl font-semibold">Comparison Matrix</h2>
        <p class="text-sm opacity-80">Sentiment by platform + overall. “—” = no data.</p></div>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm" id="compareTable">
          <thead class="text-left opacity-70"><tr>
            <th class="py-2 pr-4">Game</th><th class="py-2 pr-4">Reddit</th>
            <th class="py-2 pr-4">X</th><th class="py-2 pr-4">Threads</th>
            <th class="py-2 pr-4">Overall</th><th class="py-2 pr-4">Posts</th><th class="py-2 pr-4">Updated</th></tr></thead>
          <tbody id="compareBody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <!-- Chatbox -->
  <div class="chatbox">
    <div id="chatCard" class="card w-[22rem] hidden md:block">
      <div class="flex items-center justify-between mb-2">
        <h3 class="font-semibold">Ask the Pulse (AI)</h3>
        <button id="closeChat" class="pill">–</button>
      </div>
      <div id="chatLog" class="h-64 overflow-auto text-sm bg-zinc-50 rounded-lg border border-zinc-200 p-2 mb-2"></div>
      <div class="flex gap-2">
        <input id="chatInput" class="flex-1 pill" placeholder="Ask about CODM / PUBG…">
        <button id="chatSend" class="pill">Send</button>
      </div>
      <p class="text-xs opacity-70 mt-2">Powered by your Cloudflare Worker (keeps your OpenAI key hidden).</p>
    </div>
    <button id="openChat" class="pill md:hidden">Ask the Pulse</button>
  </div>

  <footer class="max-w-7xl mx-auto px-4 pb-10 text-xs opacity-70">
    <p>Data fetched via backend proxies to avoid CORS and protect keys. Reddit + Twitter required; Threads optional.</p>
  </footer>

  <script src="sentiment.js"></script>
  <script src="config.js"></script>
  <script src="app.js"></script>
</body></html>
